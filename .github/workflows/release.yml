name: Build&Publish

on:
  #目前是手动发版
  workflow_dispatch:

jobs:
#  release:
#    runs-on: ubuntu-latest
#      permissions:
#        contents: read
#        packages: write
#        id-token: write
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v3
#
#      - name: Setup
#        uses: actions/setup-go@v3
#        with:
#          go-version-file: "go.mod"
#
#      - name: Build
#        run: make release
#
#      - name: Release
#        uses: softprops/action-gh-release@v1
#        with:
#          files: release/*
#          draft: true
#          generate_release_notes: true
#          body: |
#            * 这是 GitHub Actions 自动化部署，更新日志应该很快会手动更新

  docker:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      packages: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Log in to GHCR
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Build Docker image
        run: |
          IMAGE_NAME=ghcr.io/${{ github.repository_owner }}/gymdl
          docker build -t $IMAGE_NAME:latest .

      - name: Push Docker image to GHCR
        run: |
          IMAGE_NAME=ghcr.io/${{ github.repository_owner }}/gymdl
          docker push $IMAGE_NAME:latest
